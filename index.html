<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rent vs Buy (NSW)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="font-sans bg-gray-50 flex flex-col h-screen">

    <header class="bg-white border-b border-gray-200 p-4 shadow-sm w-full z-20">
        <div class="max-w-7xl mx-auto">
            <h1 class="text-xl md:text-2xl font-bold text-gray-800">Who Pays for the Asset? A Renter's Map of NSW</h1>
            <p class="text-sm text-gray-600 mt-1">
                This map compares median weekly rent to an estimated mortgage payment in each postcode. Red areas
                highlight where rent is higher than the mortgage, meaning tenants aren't just covering owning costs but
                are also helping pay off an asset they have no ownership over.
            </p>
        </div>
    </header>

    <main class="flex flex-col md:flex-row flex-grow min-h-0">

        <div id="data-table-panel"
            class="w-full md:w-1/3 max-w-lg bg-white p-4 shadow-xl flex-col h-full hidden md:flex">
            <h2 class="text-2xl font-extrabold text-gray-800 mb-4 sticky top-0 bg-white pt-1 pb-2 border-b">
                Housing Cost Data
            </h2>
            <div class="mb-4">
                <input type="text" id="search-input" placeholder="Search postcode or suburb..."
                    class="w-full p-2 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
            </div>

            <div class="flex-grow overflow-y-auto">
                <table id="data-table" class="min-w-full divide-y divide-gray-200">
                    <thead class="sticky top-0 bg-gray-50 z-10">
                        <tr>
                            <th data-sort="suburb"
                                class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100">
                                Suburb</th>
                            <th data-sort="postcode"
                                class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100">
                                Postcode</th>
                            <th data-sort="ratio"
                                class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100">
                                Ratio</th>
                            <th data-sort="rent"
                                class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100">
                                Rent (Wk)</th>
                            <th data-sort="mortgage_payment"
                                class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100">
                                Mortgage (Wk)</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body" class="bg-white divide-y divide-gray-200">
                    </tbody>
                </table>
                <div id="loading-table" class="p-4 text-center text-sm text-gray-500">Loading data...</div>
            </div>
        </div>

        <div id="map-container" class="flex-grow relative h-full">
            <div id="map"></div>

            <div id="controls" class="info-card absolute top-4 right-4 rounded-xl w-72 md:w-80 z-[1000]">
                <div id="controls-header"
                    class="p-4 md:p-5 flex justify-between items-center cursor-pointer hover:bg-gray-100/50 rounded-xl">
                    <h1 class="text-sm font-bold text-gray-800">Mortgage Settings</h1>
                    <svg id="controls-chevron" class="w-6 h-6 text-gray-600 transition-transform" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>

                <div id="controls-content" class="px-4 md:px-5 pb-4 md:pb-5 border-t border-gray-200 hidden">
                    <p class="text-xs text-gray-600 pt-4 mb-4">
                        Map color indicates the Weekly Rent / Weekly Mortgage Payment ratio.
                        <span id="explanation" class="font-semibold block mt-1">
                            A ratio > 1 (Red) means Rent is more expensive than the Mortgage Payment.
                        </span>
                    </p>

                    <div class="space-y-3 mb-6">
                        <div class="flex flex-col">
                            <label for="mortgageType" class="text-xs font-medium text-gray-700">Mortgage Type</label>
                            <select id="mortgageType"
                                class="p-2 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="PI">Principal & Interest (P+I)</option>
                                <option value="IO">Interest Only (IO)</option>
                            </select>
                        </div>
                        <div class="flex flex-col">
                            <label for="interestRate" class="text-xs font-medium text-gray-700">Interest Rate
                                (%)</label>
                            <input type="number" id="interestRate" value="6.5" step="0.1"
                                class="p-2 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div class="flex flex-col" id="loanTermGroup">
                            <label for="loanTerm" class="text-xs font-medium text-gray-700">Loan Term (Years)</label>
                            <input type="number" id="loanTerm" value="30"
                                class="p-2 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div class="flex flex-col">
                            <label class="text-xs font-medium text-gray-700 mb-1">Deposit Input Type</label>
                            <div class="flex space-x-4 mb-2 text-xs">
                                <label><input type="radio" name="depositType" value="percent" checked> Percentage
                                    (%)</label>
                                <label><input type="radio" name="depositType" value="amount"> Amount ($)</label>
                            </div>
                            <input type="number" id="depositPercent" value="20"
                                class="p-2 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500"
                                style="display: block;">
                            <input type="number" id="depositAmount" value="100000"
                                class="p-2 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500"
                                style="display: none;">
                        </div>
                    </div>

                    <div id="metadata" class="text-xs text-gray-500">
                        Data sourced from 
                        <a href="https://dcj.nsw.gov.au/about-us/families-and-communities-statistics/housing-rent-and-sales/rent-and-sales-report.html" target="_blank" class="text-blue-600 hover:underline">
                            NSW Dept. of Planning, Housing & Infrastructure
                        </a>.
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="mobile-view-toggle"
        class="md:hidden fixed bottom-4 left-1/2 -translate-x-1/2 z-[1000] flex gap-2 bg-white/80 backdrop-blur-sm p-2 rounded-full shadow-lg">
        <button id="show-map-btn" class="px-6 py-2 rounded-full text-sm font-bold bg-blue-600 text-white">Map</button>
        <button id="show-list-btn"
            class="px-6 py-2 rounded-full text-sm font-bold bg-gray-200 text-gray-700">List</button>
    </div>

    <template id="popup-template">
        <div class="p-2 font-sans w-64">
            <h3 class="text-base font-bold mb-0 leading-tight" id="popup-suburbs"></h3>
            <div class="text-xs text-gray-500 mb-2" id="popup-postcode"></div>

            <div class="mb-2 border-b pb-2">
                <h4 class="text-xs font-bold text-gray-700 mb-1">Median Weekly Costs</h4>

                <div class="flex justify-between items-center">
                    <span class="text-xs">Median Rent:</span>
                    <span id="median-rent-weekly" class="font-semibold text-sm text-blue-700"></span>
                </div>

                <div class="flex justify-between items-center">
                    <span class="text-xs" id="mortgage-label">Payment:</span>
                    <span id="mortgage-payment-weekly" class="font-semibold text-sm text-red-600"></span>
                </div>

                <div id="interest-component-wrapper" class="flex justify-between items-center hidden">
                    <span class="text-xs pl-2 text-gray-600">â”” Interest Component:</span>
                    <span id="interest-component-weekly" class="font-semibold text-sm text-gray-600"></span>
                </div>
            </div>

            <h4 class="text-xs font-semibold mt-2 mb-1">Weekly Cost Range</h4>
            <div class="box-plot-container" id="box-plot-container">
                <div id="box-plot-rent" class="box-plot-area"></div>
                <div id="box-plot-mortgage" class="box-plot-area"></div>
            </div>

            <div class="text-xs text-gray-500 mt-1">Median Sale Price: <span id="median-sale-price-000s"></span> k</div>
        </div>
    </template>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="map_app.js"></script>
    <script async src="https://cdn.counter.dev/script.js" data-id="2fd9f514-57b3-4a7e-bcab-1f565aff04d0"
        data-utcoffset="10"></script>

</body>

</html>